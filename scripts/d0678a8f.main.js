var utils=function(){"use strict";var a=function(a,b,c,d,e){a.line(b,c,d,e)},b=function(a,b,c){a.ellipse(b,c,2,2)},c=function(a,b){var c;for(c in a)a[c]=b[c]||a[c];return a};return{d1:a,d2:b,merge:c}}(),app=app||{},MAX_POINTS=1e3;app.gmlEditor=function(){var a,b,c,d,e=[],f=-1,g=function(c,d){var g=new Date;-1===f&&(f=g);var h=g-f;e.push({x:c/a,y:d/b,z:0,t:h}),$("#m-points").html(MAX_POINTS-e.length)},h=function(a){e.forEach(function(b){b.t=b.t/(a-f)})},i=function(c){function d(){c.size(a,b),c.background(245,246,243),c.stroke(0),console.log("setting up")}function f(){m(),c.fill(0),c.ellipse(c.mouseX-1,c.mouseY-1,2,2),g(c.mouseX,c.mouseY),console.log(e)}function i(){e.length>=MAX_POINTS||(c.fill(0),c.ellipse(c.mouseX-1,c.mouseY-1,2,2),g(c.mouseX,c.mouseY))}function j(){var a=new Date;h(a)}c.setup=d,c.mousePressed=f,c.mouseDragged=i,c.mouseReleased=j},j=function(){var a=new X2JS,b={};b={tag:{drawing:{stroke:{pt:[]}}}},e.forEach(function(a){b.tag.drawing.stroke.pt.push(a)});{var c='<gml spec="1.0">'+a.json2xml_str(b)+"</gml>";({gml:c,time:Date.now()})}return c},k=function(){},l=function(f,g,h,j){var l=document.getElementById(f);if(l){c=document.createElement("canvas"),$(l).append('<div id="m-pointcount"><span id="m-points"></span> points left</div>'),l.appendChild(c),a=h||500,b=j||500,d=g||k,$("#m-points").html(MAX_POINTS-e.length);{new Processing(c,i)}}},m=function(){e=[],f=-1;var d=c.getContext("2d");d.fillStyle="rgb(245,246,243)",d.fillRect(0,0,a,b)},n=function(){return e};return{init:l,getGML:j,clear:m,getPoints:n}}();var d1=function(a,b,c,d,e){"use strict";a.line(b,c,d,e)},d2=function(a,b,c){"use strict";a.ellipse(b,c,2,2)};app.gmlRenderer=function(){"use strict";var a,b,c,d,e,f=[],g=function(d){function g(){d.size(a,b),d.background(245,246,243),d.stroke(0),console.log("setting up"),d.fill(0),f.forEach(function(g,h){var i=g,j=h;0!==h&&!function(){setTimeout(function(){e(d,i.x*a-1,i.y*b-1,f[j-1].x*a-1,f[j-1].y*b-1)},i.t*c)}()})}d.setup=g},h=function(){if(d){var c=d.getContext("2d");c.fillStyle="rgb(245,246,243)",c.fillRect(0,0,a,b)}},i=function(e,h,i,j,k){c=i||1e3;var l=document.getElementById(e);if(l){d=document.createElement("canvas");var m=_.template($("#drawing-card-template").html()),i=$(m).appendTo(l);i.appendChild(d),a=j||500,b=k||500,f=h.tag.drawing.stroke.pt,console.log(f);{new Processing(d,g)}}},j=function(a,b,c,d,f){h(),e=b||{},socket.emit("get",""),socket.on("returnGml",function(b){var e=new X2JS,g=JSON.parse(b);console.log(g),console.log(g);var h=e.xml_str2json(g.gml).gml;console.log(h),console.log(h),window.gml=h,i(a,h,c,d,f)})};return{init:j,clear:h}}();var GmlCanvas=function(a,b){"use strict";this.clear(),this.containerId=a;var c={drawingFun:{},width:500,height:500,backgroundColor:[245,246,243],strokeColor:[0,0,0]};this.settings=utils.merge(c,b)};GmlCanvas.prototype.render=function(a,b){"use strict";var c=this;this.duration=b;var d=document.getElementById(c.containerId);if(d){this.canvas=document.createElement("canvas");var e=_.template($("#drawing-card-template").html()),f=$(e()).appendTo(d);$(f).append(this.canvas),this.points=a.tag.drawing.stroke.pt;{new Processing(c.canvas,c._sketch(),c)}}},GmlCanvas.prototype.clear=function(){"use strict";if(this.canvas){var a=this.canvas.getContext("2d");a.fillStyle="rgb(245,245,246)",a.fillRect(0,0,this.settings.width,this.settings.height)}},GmlCanvas.prototype._sketch=function(){"use strict";var a=this;return function(b){function c(){b.size(a.settings.width,a.settings.height),b.background.apply(b,a.settings.backgroundColor),b.stroke.apply(b,a.settings.strokeColor),b.fill.apply(b,a.settings.strokeColor),a.points.forEach(function(c,e){var f=c,g=e;0!==e&&!function(){setTimeout(function(){a.settings.drawingFun(b,f.x*a.settings.width-1,f.y*a.settings.height-1,a.points[g-1].x*a.settings.width-1,a.points[g-1].y*a.settings.height-1)},f.t*d)}()})}var d=a.duration;b.setup=c}},app.renderer=function(){"use strict";var a=function(a){var b=a,c=x2js.xml_str2json(b.pts).gml;if(0===c.tag.drawing.stroke.pt.length){console.log("text : "+b.text);var d=_.template($("#text-card-template").html());console.log(d),$("#cards").append(d({text:b.text}))}else{var e=new GmlCanvas(containerId,{width:270,height:270,drawingFun:utils.d1,backgroundColor:[240,240,240],strokeColor:[3]});e.render(c,5e3)}};return{render:a}}();var app=app||{};app.form=function(){"use strict";var a=($("#moon-form"),function(){app.gmlEditor.init("draw-input",600,600),c()}),b=function(){var a=d(),b=e(a,function(){});b?f(a):!1},c=function(){$(".erase").on("click",function(){app.gmlEditor.clear()}),$(".anon").on("click",function(){console.log("click"),b(),app.gmlEditor.clear()})},d=function(){var a=$("#m-textarea").val(),b=(app.gmlEditor.getPoints(),{text:a||"",pts:app.gmlEditor.getGML()}),c={age:"#m-age",name:"#m-name",country:"#m-country"};for(var d in c)b[d]=$(c[d]).val();return b},e=function(a){return console.log(a),a.text||0!==app.gmlEditor.getPoints().length?!0:!1},f=function(a){return console.log("uploading"),a&&(a.time=Date.now(),console.log("saving "+JSON.stringify(a)),$.ajax({type:"POST",url:"http://54.68.129.229",crossDomain:!0,data:JSON.stringify(a),dataType:"json",success:function(a){a.someKey},error:function(){console.log("POST failed.")}})),!1};return{init:a,upload:f}}(),app.form.init();